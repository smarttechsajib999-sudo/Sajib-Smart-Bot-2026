name: Sajib_Viral_India_Bot_Pro
on:
  workflow_dispatch: # ‡¶§‡ßÅ‡¶á ‡¶Ø‡¶ñ‡¶® ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶ö‡¶æ‡¶≤‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡¶ø
  schedule:
    - cron: '0 * * * *' # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡ßü ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶ö‡¶≤‡¶¨‡ßá (Total 12-24 times/day)

jobs:
  viral_production:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v3

      # ‡ßß. ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (‡¶∏‡¶¨ ‡¶ü‡ßÅ‡¶≤‡¶∏)
      - name: Install High-End Video Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y libjpeg-dev zlib1g-dev libpng-dev imagemagick ffmpeg
          sudo sed -i 's/none/read,write/g' /etc/ImageMagick-6/policy.xml

      # ‡ß®. ‡¶¨‡ßç‡¶∞‡ßá‡¶® ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ (AI & Video Libraries)
      - name: Install Python AI Brain
        run: |
          pip install --upgrade pip
          pip install "Pillow==9.5.0" moviepy==1.0.3
          pip install openai edge-tts requests beautifulsoup4 lxml google-api-python-client google-auth-oauthlib pytrends

          cat << 'EOF' > bot.py
          import os, sys, pickle, requests, asyncio, random, time
          import PIL.Image
          if not hasattr(PIL.Image, 'ANTIALIAS'): PIL.Image.ANTIALIAS = PIL.Image.LANCZOS

          from openai import OpenAI
          import edge_tts
          from moviepy.editor import VideoFileClip, AudioFileClip, concatenate_videoclips, CompositeAudioClip, TextClip, CompositeVideoClip
          from bs4 import BeautifulSoup
          from googleapiclient.discovery import build
          from googleapiclient.http import MediaFileUpload

          # --- CONFIGURATION ---
          client = OpenAI(api_key="0afdca64-4ba2-4556-ae28-e9f227abecb0", base_url="https://api.sambanova.ai/v1")
          P_KEY = "BjHJTux4O3vjypGJOkerA1DQkj9czukgBQyiYj9OH04hE9EKQp6TJEc5"
          
          # ‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶® ‡¶≠‡¶æ‡¶á‡¶∞‡¶æ‡¶≤ ‡¶ï‡¶ø‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°‡¶∏
          VIRAL_KEYWORDS = ["Indian tech news", "ISRO updates", "Indian railways new tech", "Jio latest offer", "Made in India gadgets", "Viral Indian hacks"]

          async def run():
              try:
                  print("--- VIRAL ENGINE STARTED ---")
                  
                  # 1. ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶≤‡¶ó‡¶á‡¶®
                  t_file = "token.pickle" if os.path.exists("token.pickle") else "token (1).pickle"
                  if not os.path.exists(t_file): raise Exception("Token missing!")
                  with open(t_file, 'rb') as t: creds = pickle.load(t)
                  yt = build("youtube", "v3", credentials=creds)

                  # 2. ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶∞‡¶ø‡¶∏‡¶æ‡¶∞‡ßç‡¶ö (‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶∏ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤)
                  # ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ò‡ßÅ‡¶∞‡¶ø‡ßü‡ßá ‡¶´‡¶ø‡¶∞‡¶ø‡ßü‡ßá ‡¶ü‡¶™‡¶ø‡¶ï ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶ò‡ßá‡ßü‡ßá ‡¶®‡¶æ ‡¶π‡ßü
                  search_q = random.choice(VIRAL_KEYWORDS)
                  print(f"Researching Viral Topic on: {search_q}...")
                  
                  r = requests.get(f"https://news.google.com/rss/search?q={search_q}&hl=bn&gl=IN&ceid=IN:bn")
                  soup = BeautifulSoup(r.content, features="xml")
                  items = soup.findAll('item')
                  
                  if not items: 
                      print("No news found, using backup topic.")
                      topic = "Top 5 Indian Tech Gadgets 2026"
                  else:
                      # ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡ß´‡¶ü‡¶æ ‡¶ñ‡¶¨‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶è‡¶ï‡¶ü‡¶æ ‡¶®‡ßá‡¶¨‡ßá
                      topic = items[random.randint(0, min(4, len(items)-1))].title.text

                  print(f"üî• FINAL VIRAL TOPIC: {topic}")

                  # 3. ‡¶≠‡¶æ‡¶á‡¶∞‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶∞‡¶æ‡¶á‡¶ü‡¶ø‡¶Ç (‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤)
                  print("Writing Script with 'Masala'...")
                  prompt = f"""
                  Act as a famous Indian Bengali Tech YouTuber. 
                  Write a script for a YouTube Short about: '{topic}'.
                  
                  Rules:
                  1. Language: Bengali (Mix of standard and trendy words).
                  2. Tone: Exciting, Fast-paced, Viral.
                  3. Start with a hook (Ex: "‡¶ú‡¶æ‡¶®‡ßá‡¶® ‡¶ï‡¶ø ‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶§‡ßá ‡¶ï‡ßÄ ‡¶π‡¶§‡ßá ‡¶ö‡¶≤‡ßá‡¶õ‡ßá?").
                  4. Length: Exactly 45 seconds of speaking.
                  5. No emojis, just text.
                  """
                  script = client.chat.completions.create(model='Meta-Llama-3.1-8B-Instruct', messages=[{"role": "user", "content": prompt}]).choices[0].message.content
                  
                  # ‡¶≠‡ßü‡ßá‡¶∏ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶∂‡¶®
                  await edge_tts.Communicate(script, "bn-BD-PradeepNeural").save("voice.mp3")

                  # 4. ‡ßß‡ß¶‡¶ü‡¶æ ‡¶∏‡¶ø‡¶® ‡¶Æ‡¶ø‡¶ï‡ßç‡¶∏‡¶ø‡¶Ç (Ten-Scene Strategy)
                  print("Downloading 5-8 Dynamic Clips...")
                  headers = {"Authorization": P_KEY}
                  
                  # ‡¶ü‡¶™‡¶ø‡¶ï‡ßá‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ü‡¶æ‡¶∞‡ßç‡¶Æ
                  search_terms = ["technology india", "future city", "ai robot", "smartphone", "digital india", "cyberpunk", "hacker", "coding"]
                  random.shuffle(search_terms)
                  
                  clips = []
                  downloaded_count = 0
                  
                  for term in search_terms:
                      if downloaded_count >= 6: break # ‡ß¨-‡ßÆ‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶™ ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü
                      
                      v_res = requests.get(f"https://api.pexels.com/videos/search?query={term}&orientation=portrait&per_page=3", headers=headers).json()
                      if v_res.get('videos'):
                          # ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡¶ø‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá
                          vid_obj = v_res['videos'][random.randint(0, len(v_res['videos'])-1)]
                          v_url = vid_obj['video_files'][0]['link']
                          
                          fname = f"clip_{downloaded_count}.mp4"
                          with open(fname, "wb") as f: f.write(requests.get(v_url).content)
                          
                          # ‡¶ï‡ßç‡¶≤‡¶ø‡¶™ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç (‡ß®-‡ß© ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶´‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶æ‡¶ü)
                          try:
                              clip = VideoFileClip(fname).resize(height=1920).crop(x1=0, width=1080, height=1920)
                              # ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶™ ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶°‡¶ø‡¶â‡¶∞‡ßá‡¶∂‡¶® (‡ß® ‡¶•‡ßá‡¶ï‡ßá ‡ß™ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°)
                              clip_duration = random.uniform(2.5, 4.5)
                              clip = clip.subclip(0, clip_duration)
                              clips.append(clip)
                              downloaded_count += 1
                              print(f"Clip {downloaded_count} added ({term})")
                          except:
                              pass

                  # 5. ‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡¶ø ‡¶è‡¶°‡¶ø‡¶ü‡¶ø‡¶Ç (Mixing)
                  print("Mixing everything like a Pro Editor...")
                  voice_audio = AudioFileClip("voice.mp3")
                  
                  # ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï (‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶∏/‡¶ü‡ßá‡¶ï)
                  bg_url = "https://cdn.pixabay.com/download/audio/2022/03/22/audio_c8c8a73467.mp3" # Tech Background
                  with open("bg.mp3", "wb") as f: f.write(requests.get(bg_url).content)
                  bg_audio = AudioFileClip("bg.mp3").volumex(0.12).subclip(0, voice_audio.duration) # ‡¶≠‡¶≤‡¶ø‡¶â‡¶Æ ‡¶ï‡¶Æ
                  
                  # ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ú‡ßã‡ßú‡¶æ ‡¶≤‡¶æ‡¶ó‡¶æ‡¶®‡ßã
                  final_visual = concatenate_videoclips(clips, method="compose")
                  
                  # ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ø‡¶¶‡¶ø ‡¶≠‡ßü‡ßá‡¶∏‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶õ‡ßã‡¶ü ‡¶π‡ßü, ‡¶≤‡ßÅ‡¶™ ‡¶ï‡¶∞‡¶¨‡ßá
                  while final_visual.duration < voice_audio.duration:
                      final_visual = concatenate_videoclips([final_visual, final_visual])
                  
                  # ‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶ï‡¶æ‡¶ü
                  final_visual = final_visual.subclip(0, voice_audio.duration)
                  
                  # ‡¶Ö‡¶°‡¶ø‡¶ì ‡¶Æ‡¶ø‡¶ï‡ßç‡¶∏
                  final_audio = CompositeAudioClip([voice_audio, bg_audio])
                  final_video = final_visual.set_audio(final_audio)
                  
                  # 6. ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø‡¶Ç
                  final_video.write_videofile("final_viral.mp4", codec="libx264", audio_codec="aac", fps=24, logger=None)

                  # 7. ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ì ‡¶∂‡¶ø‡¶°‡¶ø‡¶â‡¶≤ ‡¶Æ‡ßá‡¶á‡¶®‡¶ü‡ßá‡¶á‡¶®
                  print("Uploading Viral Short...")
                  tags = ["#Shorts", "#India", "#TechNews", "#Viral", "#BanglaNews", "#Gadgets"]
                  title = f"{topic[:50]}... üò±üî• #Shorts"
                  
                  request = yt.videos().insert(
                      part="snippet,status",
                      body={
                          "snippet": {
                              "title": title, 
                              "description": f"{topic}\n\nSubscribe for more Indian Tech Updates!\n{' '.join(tags)}",
                              "categoryId": "28"
                          },
                          "status": {"privacyStatus": "public"}
                      },
                      media_body=MediaFileUpload("final_viral.mp4")
                  )
                  res = request.execute()
                  print(f"SUCCESS! Video is Live: https://youtube.com/shorts/{res['id']}")

              except Exception as e:
                  print(f"ERROR: {str(e)}")
                  sys.exit(1)

          if __name__ == "__main__": asyncio.run(run())
          EOF
          
          python bot.py
          
